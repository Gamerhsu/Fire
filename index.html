<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREè²¡å‹™ç¨ç«‹è¨ˆç®—æ©Ÿbyæ•ˆç‡å……é›»ç«™</title>
    <!-- å¼•å…¥ Google Fonts å’Œ Chart.js åœ–è¡¨åº« -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- å…¨å±€æ¨£å¼ï¼šå®šç¾©æ•´å€‹ç¶²ç«™çš„é¡è‰²è®Šæ•¸ --- */
        :root {
            --primary-color: #7EBDC3;      /* æŸ”å’Œé’è— (æ¨™é¡Œ) */
            --secondary-color: #7A6263;     /* æ²‰ç©©æš–æ£• (æŒ‰éˆ•) */
            --background-color: #DFF2D8;   /* é é¢èƒŒæ™¯ (æ¥µæ·ºç±³ç¶ ) */
            --card-bg-color: #FFFFFF;       /* ä¸»å®¹å™¨èƒŒæ™¯ (ç™½) */
            --text-color: #3D3531;          /* æ·±æ£•æ–‡å­—è‰² */
            --light-text-color: #6c757d;    /* æ·ºç°æ–‡å­—è‰² */
            --border-color: #dee2e6;        /* é‚Šæ¡†è‰² */
            --success-color: #8CB369;       /* æ¸…æ–°ç¶  (æ›¿ä»£èˆŠçš„ç¶ è‰²) */
            --info-color: #CED097;          /* æº«å’Œè‰ç¶  (åœ–è¡¨æœ¬é‡‘è‰²) */
        }

        /* --- åŸºç¤ Body æ¨£å¼ --- */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 15px;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        /* --- ä¸»å®¹å™¨æ¨£å¼ --- */
        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--card-bg-color);
            padding: clamp(20px, 5vw, 40px);
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            box-sizing: border-box;
        }

        /* --- é é¦–æ¨£å¼ --- */
        header {
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
        }

        /* --- æ–°å¢ï¼šä»‹ç´¹èˆ‡å®šç¾©å€å¡Šæ¨£å¼ --- */
        .intro-section, .definitions-section {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .intro-section h2, .definitions-section h2 {
            color: var(--primary-color);
            text-align: left;
            margin-top: 0;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            font-size: 1.5rem;
        }
        .definitions-section details {
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .definitions-section details:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .definitions-section summary {
            font-weight: 500;
            cursor: pointer;
            color: var(--secondary-color);
            padding: 5px 0;
            list-style: 'ğŸ’¡ ';
        }
        .definitions-section p {
            margin-top: 10px;
            padding-left: 20px;
            color: var(--light-text-color);
        }

        /* --- è¡¨å–®æ¨£å¼ --- */
        .calculator-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 600px) {
            .calculator-form {
                grid-template-columns: 1fr 1fr;
            }
            .full-width {
                grid-column: 1 / -1;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--light-text-color);
            font-size: 14px;
        }

        .input-group input {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            width: 100%;
            box-sizing: border-box;
            background-color: #f8f9fa;
        }
        
        /* --- æŒ‰éˆ•æ¨£å¼ --- */
        #calculateBtn {
            background: var(--secondary-color);
            color: white;
            padding: 15px 32px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(122, 98, 99, 0.3);
        }

        #calculateBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(122, 98, 99, 0.4);
        }

        #calculateBtn:active {
            transform: translateY(0);
        }

        /* --- çµæœå€å¡Šæ¨£å¼ --- */
        .hidden {
            display: none;
        }

        .results-section {
            margin-top: 40px;
            border-top: 1px solid var(--border-color);
            padding-top: 20px;
        }

        .results-section h2, .interactive-section h2, .post-fire-section h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 25px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 5px solid var(--success-color);
        }

        .card h3 {
            margin-top: 0;
            color: var(--light-text-color);
            font-size: 16px;
        }

        .card p {
            font-size: clamp(1.5rem, 4vw, 1.8rem);
            font-weight: 700;
            color: var(--success-color);
            margin-bottom: 0;
        }

        /* --- åœ–è¡¨å®¹å™¨æ¨£å¼ --- */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        @media (min-width: 768px) {
            .charts-container {
                grid-template-columns: 2fr 1fr;
            }
        }

        .chart-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .chart-card h3 {
            text-align: center;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .chart-text {
            text-align: center;
            color: var(--light-text-color);
            margin-top: 15px;
            font-size: 14px;
            padding: 0 10px;
        }
        
        /* --- äº’å‹•å€å¡Šæ¨£å¼ --- */
        .interactive-section {
            margin-top: 40px;
            padding: 20px;
            border-top: 1px solid var(--border-color);
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .slider-group label {
            font-weight: 500;
        }

        .slider-group input[type="range"] {
            width: 100%;
            cursor: pointer;
        }

        .slider-effect {
            text-align: center;
            font-weight: 500;
            color: var(--secondary-color);
            background-color: #fff;
            padding: 8px;
            border-radius: 6px;
            margin-top: 10px;
            min-height: 24px;
        }

        /* --- FIREå¾Œè³‡ç”¢é ä¼°å€å¡Šæ¨£å¼ --- */
        .post-fire-section {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .post-fire-section .card {
            border-left-color: var(--info-color);
            max-width: 400px;
            margin: 0 auto;
        }
        .post-fire-section .card p {
            color: var(--info-color);
        }
        .post-fire-section .card span {
            display: block;
            font-size: 14px;
            color: var(--light-text-color);
            margin-top: 5px;
        }

        /* --- é å°¾æ¨£å¼ --- */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
            font-size: 14px;
            color: var(--light-text-color);
        }

        .branding {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .branding img {
            height: 40px;
            width: 40px;
            border-radius: 50%;
            object-fit: cover; /* ç¢ºä¿åœ–ç‰‡ä¸è®Šå½¢ */
        }

        .branding a {
            color: var(--secondary-color);
            text-decoration: none;
            font-weight: 500;
        }
        .branding a:hover {
            text-decoration: underline;
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>ğŸ”¥ FIRE è²¡å‹™ç¨ç«‹è¨ˆç®—æ©Ÿ </h1>
            <h2>æ•ˆç‡å……é›»ç«™ AI Project I</h2>
            <p>æƒ³çŸ¥é“è‡ªå·±è·é›¢ã€Œæƒ³å·¥ä½œæ‰å·¥ä½œã€çš„è‡ªç”±äººç”Ÿé‚„æœ‰å¤šé å—ï¼Ÿè¼¸å…¥æ‚¨çš„è²¡å‹™ç‹€æ³ï¼Œè®“æˆ‘å€‘ç”¨æ•¸æ“šç‚ºæ‚¨æç¹ªå‡ºé€šå¾€è²¡å‹™ç¨ç«‹çš„è—åœ–ï¼</p>
        </header>

        <main>
            <!-- æ–°å¢ï¼šä»‹ç´¹å€å¡Š -->
            <div class="intro-section">
                <h2>ä»€éº¼æ˜¯ FIRE é‹å‹•ï¼Ÿ</h2>
                <p>FIRE ä»£è¡¨ <strong>F</strong>inancial <strong>I</strong>ndependence, <strong>R</strong>etire <strong>E</strong>arly (è²¡å‹™ç¨ç«‹ï¼Œææ—©é€€ä¼‘)ã€‚å®ƒçš„æ ¸å¿ƒä¸¦éå®Œå…¨ä¸å·¥ä½œï¼Œè€Œæ˜¯é”åˆ°ä¸€ç¨®ã€Œå¯ä»¥è‡ªç”±é¸æ“‡æ˜¯å¦è¦ç‚ºéŒ¢å·¥ä½œã€çš„ç‹€æ…‹ï¼Œæ‹¿å›<strong>æ™‚é–“çš„è‡ªä¸»æ¬Š</strong>ï¼Œå»åšè‡ªå·±çœŸæ­£ç†±æ„›çš„äº‹ã€‚é”æˆé€™å€‹ç›®æ¨™çš„ä¸‰å¤§æ”¯æŸ±æ˜¯ï¼š<strong>é«˜å„²è“„ç‡ã€é•·æœŸæŠ•è³‡ã€ä»¥åŠæœ‰æ„è­˜çš„æ¶ˆè²»</strong>ã€‚é€™å€‹è¨ˆç®—æ©Ÿå°‡å¹«åŠ©æ‚¨è¸å‡ºè¦åŠƒçš„ç¬¬ä¸€æ­¥ï¼</p>
            </div>

            <!-- æ–°å¢ï¼šåè©è§£é‡‹å€å¡Š -->
            <div class="definitions-section">
                <h2>æ ¸å¿ƒåè©è§£é‡‹</h2>
                <details>
                    <summary>ä»€éº¼æ˜¯ã€Œè²¡å‹™ç¨ç«‹ã€ (Financial Independence)ï¼Ÿ</summary>
                    <p>ç•¶æ‚¨ç´¯ç©çš„è³‡ç”¢æ‰€ç”¢ç”Ÿçš„ã€Œè¢«å‹•æ”¶å…¥ã€ï¼ˆå¦‚è‚¡æ¯ã€ç§Ÿé‡‘ã€æŠ•è³‡åˆ©å¾—ï¼‰è¶³ä»¥æ”¯ä»˜æ‚¨çš„ã€Œå¹´åº¦ç¸½æ”¯å‡ºã€æ™‚ï¼Œå°±é”æˆäº†è²¡å‹™ç¨ç«‹ã€‚</p>
                </details>
                <details>
                    <summary>ä»€éº¼æ˜¯ã€Œ4% æ³•å‰‡ã€ (The 4% Rule)ï¼Ÿ</summary>
                    <p>é€™æ˜¯ä¸€å€‹ç¶“é©—æ³•å‰‡ï¼Œç”¨ä¾†ä¼°ç®—æ‚¨çš„FIREç›®æ¨™ç¸½é¡ã€‚æ„æ€æ˜¯æ‚¨çš„é€€ä¼‘ç›®æ¨™æ˜¯<strong>å¹´æ”¯å‡ºçš„25å€</strong>ã€‚é”æˆå¾Œï¼Œæ‚¨æ¯å¹´å¾ä¸­æå–ä¸è¶…é4%çš„é‡‘é¡ä½œç‚ºç”Ÿæ´»è²»ï¼Œç†è«–ä¸Šè³‡ç”¢å¯ä»¥æŒçºŒæ”¯æ‡‰æ‚¨çš„é–‹éŠ·ã€‚</p>
                </details>
                <details>
                    <summary>ä»€éº¼æ˜¯ã€Œè¤‡åˆ©ã€ (Compound Interest)ï¼Ÿ</summary>
                    <p>ä¿—ç¨±ã€Œåˆ©æ»¾åˆ©ã€ã€‚ä¸åªæ˜¯æ‚¨çš„æœ¬é‡‘åœ¨è³ºéŒ¢ï¼Œé€£åŒè³ºä¾†çš„åˆ©æ¯ä¹Ÿæœƒåœ¨ä¸‹ä¸€æœŸç¹¼çºŒæŠ•å…¥ï¼Œæˆç‚ºæ–°çš„æœ¬é‡‘ä¸€èµ·è³ºéŒ¢ï¼Œæ˜¯è³‡ç”¢é•·æœŸå¢é•·çš„é—œéµå¼•æ“ã€‚</p>
                </details>
                <details>
                    <summary>ä»€éº¼æ˜¯ã€Œå¯¦è³ªå ±é…¬ç‡ã€ (Real Rate of Return)ï¼Ÿ</summary>
                    <p>é€™æ˜¯<strong>æ‰£é™¤é€šè²¨è†¨è„¹å½±éŸ¿å¾Œ</strong>çš„çœŸå¯¦æŠ•è³‡å ±é…¬ç‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„æŠ•è³‡è³ºäº†7%ï¼Œä½†ç•¶å¹´é€šè†¨æ˜¯2%ï¼Œæ‚¨çš„è³‡ç”¢è³¼è²·åŠ›å¯¦éš›åªå¢é•·äº†ç´„5%ã€‚é€™å€‹è¨ˆç®—æ©Ÿä½¿ç”¨å¯¦è³ªå ±é…¬ç‡ä¾†åšæ›´ç²¾ç¢ºçš„ä¼°ç®—ã€‚</p>
                </details>
            </div>

            <!-- è¨ˆç®—æ©Ÿè¡¨å–® -->
            <div class="calculator-form">
                <div class="input-group">
                    <label for="currentAge">æˆ‘ä»Šå¹´å¹¾æ­²ï¼Ÿ</label>
                    <input type="number" id="currentAge" value="30" min="1">
                </div>

                <div class="input-group">
                    <label for="monthlySpending">é€€ä¼‘å¾Œï¼Œæˆ‘å¸Œæœ›æ¯æœˆèŠ±è²» (NT$)</label>
                    <input type="number" id="monthlySpending" value="40000" step="1000" min="0">
                </div>

                <div class="input-group">
                    <label for="currentAssets">æˆ‘ç›®å‰å·²æŠ•è³‡ç”¢ (NT$)</label>
                    <input type="number" id="currentAssets" value="500000" step="10000" min="0">
                </div>

                <div class="input-group">
                    <label for="monthlyInvestment">æˆ‘æ¯æœˆå¯æŠ•è³‡é‡‘é¡ (NT$)</label>
                    <input type="number" id="monthlyInvestment" value="25000" step="1000" min="0">
                </div>
                
                <div class="input-group">
                    <label for="returnRate">é ä¼°å¹´åŒ–æŠ•è³‡å ±é…¬ç‡ (%)</label>
                    <input type="number" id="returnRate" value="7" step="0.5">
                </div>

                <div class="input-group">
                    <label for="inflationRate">é ä¼°å¹´é€šè²¨è†¨è„¹ç‡ (%)</label>
                    <input type="number" id="inflationRate" value="2" step="0.1">
                </div>

                <div class="input-group full-width">
                    <label for="withdrawalRate">é€€ä¼‘å¾Œè³‡ç”¢æé ˜ç‡ (%) - (4%æ³•å‰‡)</label>
                    <input type="number" id="withdrawalRate" value="4" step="0.1">
                </div>
                
                <button id="calculateBtn" class="full-width">ğŸš€ é–‹å§‹è¨ˆç®—æˆ‘çš„FIREè—åœ–</button>
            </div>

            <div id="results" class="results-section hidden">
                <h2>ç¬¬äºŒæ­¥ï¼šæ‚¨çš„è²¡å‹™ç¨ç«‹åˆ†æå ±å‘Š</h2>
                <div class="summary-cards">
                    <div class="card">
                        <h3>æ‚¨çš„FIREç›®æ¨™ç¸½é¡</h3>
                        <p id="fireTargetResult">NT$ 12,000,000</p>
                    </div>
                    <div class="card">
                        <h3>é è¨ˆé”æˆå¹´é½¡</h3>
                        <p id="retirementAgeResult">48 æ­²</p>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <h3>ï¿½ åœ–è¡¨ä¸€ï¼šè³‡ç”¢ç´¯ç©æˆé•·æ›²ç·š</h3>
                        <canvas id="assetGrowthChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3>ğŸ“Š åœ–è¡¨äºŒï¼šé€€ä¼‘é‡‘ä¾†æºåˆ†æ</h3>
                        <canvas id="fundCompositionChart"></canvas>
                        <p id="fundCompositionText" class="chart-text"></p>
                    </div>
                </div>
                
                <div class="interactive-section">
                    <h2>ç¬¬ä¸‰æ­¥ï¼šæ¢ç´¢æ›´å¤šå¯èƒ½æ€§</h2>
                    <div class="slider-group">
                        <label for="monthlyInvestmentSlider">è©¦è‘—èª¿æ•´ã€Œæ¯æœˆæŠ•è³‡é‡‘é¡ã€ï¼š <span id="monthlyInvestmentSliderValue" style="color: var(--primary-color); font-weight:700;">NT$ 25,000</span></label>
                        <input type="range" id="monthlyInvestmentSlider" min="1000" max="150000" step="1000" value="25000">
                        <p id="investmentSliderEffect" class="slider-effect"></p>
                    </div>
                </div>

                <div class="post-fire-section">
                    <h2>ç¬¬å››æ­¥ï¼šFIRE å¾Œçš„è³‡ç”¢é ä¼°</h2>
                    <div class="card">
                        <h3>è‹¥é”æ¨™å¾Œæ¯å¹´æé ˜ç”Ÿæ´»è²»...</h3>
                        <p id="assetsAt80Result">NT$ 0</p>
                        <span>åˆ° 80 æ­²æ™‚çš„é ä¼°å‰©é¤˜è³‡ç”¢</span>
                    </div>
                    <p class="chart-text">é€™å€‹æ•¸å­—é¡¯ç¤ºäº†åœ¨æ‚¨é”æˆè²¡å‹™ç¨ç«‹å¾Œï¼Œæ¯å¹´æé ˜ç”Ÿæ´»è²»ï¼Œä¾é è¤‡åˆ©çš„åŠ›é‡ï¼Œè³‡ç”¢èƒ½ç¹¼çºŒæˆé•·åˆ°ä»€éº¼ç¨‹åº¦ã€‚</p>
                </div>

            </div>
        </main>

        <footer>
            <div class="branding">
                <!-- æ‚¨çš„LOGOä½ç½® -->
                <img id="logo" src="https://i.meee.com.tw/HJ1GsKw.png" alt="æ•ˆç‡å……é›»ç«™ Logo">
                <span>
                    ç”± <a href="https://www.instagram.com/cybergame7/" target="_blank">æ•ˆç‡å……é›»ç«™</a> è£½ä½œ
                </span>
            </div>
            <p><strong>å…è²¬è²æ˜ï¼š</strong>æ‰€æœ‰è¨ˆç®—çµæœå‡åŸºæ–¼æ‚¨è¼¸å…¥çš„æ•¸æ“šå’Œé è¨­å‡è¨­ï¼Œåƒ…ä¾›åƒè€ƒï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°ã€‚å¸‚å ´æœ‰é¢¨éšªï¼ŒæŠ•è³‡éœ€è¬¹æ…ã€‚</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const calculateBtn = document.getElementById('calculateBtn');
            const resultsSection = document.getElementById('results');
            const monthlyInvestmentSlider = document.getElementById('monthlyInvestmentSlider');
            const monthlyInvestmentInput = document.getElementById('monthlyInvestment');
            
            let assetGrowthChartInstance;
            let fundCompositionChartInstance;
            let originalRetirementAge = 0;

            function initializeSlider() {
                const initialValue = monthlyInvestmentInput.value;
                monthlyInvestmentSlider.value = initialValue;
                document.getElementById('monthlyInvestmentSliderValue').textContent = `NT$ ${Number(initialValue).toLocaleString()}`;
            }
            initializeSlider();

            function calculateFIRE() {
                const currentAge = parseInt(document.getElementById('currentAge').value) || 0;
                const monthlySpending = parseFloat(document.getElementById('monthlySpending').value) || 0;
                let currentAssets = parseFloat(document.getElementById('currentAssets').value) || 0;
                const monthlyInvestment = parseFloat(monthlyInvestmentInput.value) || 0;
                const returnRate = (parseFloat(document.getElementById('returnRate').value) || 0) / 100;
                const inflationRate = (parseFloat(document.getElementById('inflationRate').value) || 0) / 100;
                const withdrawalRate = (parseFloat(document.getElementById('withdrawalRate').value) || 0) / 100;

                if (currentAge <= 0 || monthlySpending <= 0 || withdrawalRate <= 0) {
                    alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„æ­£æ•¸ï¼(å¹´é½¡ã€èŠ±è²»ã€æé ˜ç‡éœ€å¤§æ–¼0)");
                    return null;
                }

                const realReturnRate = ((1 + returnRate) / (1 + inflationRate)) - 1;
                
                if (realReturnRate <= 0) {
                    alert("æ³¨æ„ï¼šæ‚¨çš„é ä¼°å ±é…¬ç‡ä½æ–¼æˆ–ç­‰æ–¼é€šè†¨ç‡ï¼Œè³‡ç”¢å¯èƒ½ç„¡æ³•æœ‰æ•ˆå¢é•·ä»¥é”æˆFIREç›®æ¨™ã€‚");
                }

                const annualSpending = monthlySpending * 12;
                const fireTarget = annualSpending / withdrawalRate;
                
                let futureAssets = currentAssets;
                let years = 0;
                let totalPrincipal = currentAssets;
                
                const MAX_YEARS = 100;
                let ageLabels = [];
                let assetData = [];

                while (futureAssets < fireTarget && years < MAX_YEARS) {
                    ageLabels.push(currentAge + years);
                    assetData.push(futureAssets);
                    
                    const annualInvestment = monthlyInvestment * 12;
                    futureAssets = (futureAssets + annualInvestment) * (1 + realReturnRate);
                    totalPrincipal += annualInvestment;
                    years++;
                }

                const retirementAge = currentAge + years;
                
                if (years < MAX_YEARS) {
                    ageLabels.push(retirementAge);
                    assetData.push(fireTarget);
                } else {
                    ageLabels.push(currentAge + MAX_YEARS);
                    assetData.push(futureAssets);
                }

                const finalAssets = Math.min(futureAssets, fireTarget);
                const totalGrowth = finalAssets - totalPrincipal;

                let assetsAt80 = fireTarget;
                if (retirementAge < 80) {
                    const postFireYears = 80 - retirementAge;
                    
                    if (realReturnRate > 0) {
                        const fvOfPrincipal = fireTarget * Math.pow(1 + realReturnRate, postFireYears);
                        const fvOfWithdrawals = annualSpending * ((Math.pow(1 + realReturnRate, postFireYears) - 1) / realReturnRate);
                        assetsAt80 = fvOfPrincipal - fvOfWithdrawals;
                    } else {
                        assetsAt80 = fireTarget - (annualSpending * postFireYears);
                    }
                }
                if (assetsAt80 < 0) {
                    assetsAt80 = 0;
                }

                return { fireTarget, retirementAge, years, totalPrincipal, totalGrowth, ageLabels, assetData, assetsAt80 };
            }

            function updateUI(result) {
                if (!result) return;
                
                document.getElementById('fireTargetResult').textContent = `NT$ ${Math.round(result.fireTarget).toLocaleString()}`;
                document.getElementById('retirementAgeResult').textContent = result.years < 100 ? `${result.retirementAge} æ­²` : 'è¶…é100å¹´...';
                document.getElementById('assetsAt80Result').textContent = `NT$ ${Math.round(result.assetsAt80).toLocaleString()}`;

                renderAssetGrowthChart(result.ageLabels, result.assetData);
                renderFundCompositionChart(result.totalPrincipal, result.totalGrowth);
                
                document.getElementById('fundCompositionText').textContent = `ç¸½æŠ•å…¥æœ¬é‡‘ç´„ NT$ ${Math.round(result.totalPrincipal).toLocaleString()}ï¼Œè¤‡åˆ©ç‚ºæ‚¨å¸¶ä¾† NT$ ${Math.round(result.totalGrowth).toLocaleString()} çš„è²¡å¯Œï¼`;

                resultsSection.classList.remove('hidden');
                
                return result.retirementAge;
            }

            function renderAssetGrowthChart(labels, data) {
                const ctx = document.getElementById('assetGrowthChart').getContext('2d');
                if (assetGrowthChartInstance) assetGrowthChartInstance.destroy();
                
                const computedStyle = getComputedStyle(document.documentElement);
                const primaryColor = computedStyle.getPropertyValue('--primary-color').trim();

                assetGrowthChartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'è³‡ç”¢ç¸½é¡',
                            data: data,
                            borderColor: primaryColor,
                            backgroundColor: `${primaryColor}20`, // Add alpha for fill
                            fill: true,
                            tension: 0.2
                        }]
                    },
                    options: {
                        scales: {
                            y: { ticks: { callback: value => `NT$ ${(value / 10000).toLocaleString()}è¬` } }
                        },
                        plugins: {
                            tooltip: { callbacks: { label: context => `NT$ ${Math.round(context.parsed.y).toLocaleString()}` } }
                        }
                    }
                });
            }

            function renderFundCompositionChart(principal, growth) {
                const ctx = document.getElementById('fundCompositionChart').getContext('2d');
                if (fundCompositionChartInstance) fundCompositionChartInstance.destroy();
                
                const computedStyle = getComputedStyle(document.documentElement);
                const infoColor = computedStyle.getPropertyValue('--info-color').trim();
                const successColor = computedStyle.getPropertyValue('--success-color').trim();

                fundCompositionChartInstance = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ç¸½æŠ•å…¥æœ¬é‡‘', 'æŠ•è³‡å¢é•·'],
                        datasets: [{
                            data: [principal, growth > 0 ? growth : 0],
                            backgroundColor: [infoColor, successColor],
                            borderColor: 'var(--card-bg-color)',
                            borderWidth: 0,
                            hoverOffset: 4
                        }]
                    },
                    options: { responsive: true, plugins: { legend: { position: 'top' } } }
                });
            }
            
            calculateBtn.addEventListener('click', () => {
                const result = calculateFIRE();
                originalRetirementAge = updateUI(result);
                initializeSlider(); 
                document.getElementById('investmentSliderEffect').textContent = "è©¦è‘—æ‹–å‹•æ»‘æ¡¿ï¼Œçœ‹çœ‹å°é€€ä¼‘å¹´é½¡çš„å½±éŸ¿ï¼";
            });

            monthlyInvestmentSlider.addEventListener('input', function() {
                const value = this.value;
                monthlyInvestmentInput.value = value;
                document.getElementById('monthlyInvestmentSliderValue').textContent = `NT$ ${Number(value).toLocaleString()}`;

                const result = calculateFIRE();
                const newRetirementAge = updateUI(result);
                const effectText = document.getElementById('investmentSliderEffect');
                
                if (newRetirementAge < originalRetirementAge) {
                    effectText.textContent = `å¤ªæ£’äº†ï¼æ‚¨å°‡ææ—© ${originalRetirementAge - newRetirementAge} å¹´ï¼Œåœ¨ ${newRetirementAge} æ­²é€€ä¼‘ï¼`;
                } else if (newRetirementAge > originalRetirementAge) {
                    effectText.textContent = `æ³¨æ„ï¼Œæ‚¨å°‡å»¶å¾Œ ${newRetirementAge - originalRetirementAge} å¹´ï¼Œåœ¨ ${newRetirementAge} æ­²é€€ä¼‘ã€‚`;
                } else {
                    effectText.textContent = `é€€ä¼‘å¹´é½¡ä¸è®Šï¼Œä½†æ›´é«˜çš„æŠ•å…¥èƒ½è®“è³‡ç”¢æ›´é›„åšï¼`;
                }
            });
        });
    </script>
</body>
</html>
ï¿½